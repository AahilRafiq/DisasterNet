<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/alert-service/src/main/java/org/nitk/alertservice/config/MongoConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/alert-service/src/main/java/org/nitk/alertservice/config/MongoConfig.java" />
              <option name="originalContent" value="package org.nitk.alertservice.config;&#10;&#10;import com.mongodb.ConnectionString;&#10;import com.mongodb.MongoClientSettings;&#10;import com.mongodb.client.MongoClient;&#10;import com.mongodb.client.MongoClients;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;&#10;@Configuration&#10;public class MongoConfig {&#10;&#10;    @Bean&#10;    public MongoClient mongoClient() {&#10;        String mongoHost = System.getenv(&quot;MONGO_HOST&quot;);&#10;        if (mongoHost == null || mongoHost.isEmpty()) {&#10;            mongoHost = &quot;localhost&quot;;&#10;        }&#10;        return MongoClients.create(&#10;                MongoClientSettings.builder()&#10;                        .applyConnectionString(new ConnectionString(&quot;mongodb://&quot; + mongoHost + &quot;:27017&quot;))&#10;                        .build()&#10;        );&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.nitk.alertservice.config;&#10;&#10;import com.mongodb.ConnectionString;&#10;import com.mongodb.MongoClientSettings;&#10;import com.mongodb.client.MongoClient;&#10;import com.mongodb.client.MongoClients;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;&#10;@Configuration&#10;public class MongoConfig {&#10;&#10;    @Bean&#10;    public MongoClient mongoClient() {&#10;        String mongoHost = System.getenv(&quot;MONGO_HOST&quot;);&#10;        if (mongoHost == null || mongoHost.isEmpty()) {&#10;            mongoHost = &quot;localhost&quot;;&#10;        }&#10;        return MongoClients.create(&#10;                MongoClientSettings.builder()&#10;                        .applyConnectionString(new ConnectionString(&quot;mongodb://&quot; + mongoHost + &quot;:27017&quot;))&#10;                        .build()&#10;        );&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/alert-service/src/main/java/org/nitk/alertservice/service/RMQService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/alert-service/src/main/java/org/nitk/alertservice/service/RMQService.java" />
              <option name="originalContent" value="package org.nitk.alertservice.service;&#10;&#10;import org.springframework.stereotype.Service;&#10;import com.rabbitmq.client.ConnectionFactory;&#10;import com.rabbitmq.client.Connection;&#10;import com.rabbitmq.client.Channel;&#10;&#10;@Service&#10;public class RMQService {&#10;    private final static String QUEUE_NAME = &quot;ALERTS&quot;;&#10;    private final ConnectionFactory factory;&#10;&#10;    public RMQService() {&#10;        factory = new ConnectionFactory();&#10;        String rmqHost = System.getenv(&quot;RABBITMQ_HOST&quot;);&#10;        if (rmqHost == null || rmqHost.isEmpty()) {&#10;            rmqHost = &quot;localhost&quot;;&#10;        }&#10;        factory.setHost(rmqHost);&#10;    }&#10;&#10;    public void publishNotification(byte[] message) {&#10;        try (Connection connection = factory.newConnection();&#10;             Channel channel = connection.createChannel()) {&#10;            channel.queueDeclare(QUEUE_NAME, false, false, false, null);&#10;            channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message);&#10;            System.out.println(&quot; [x] Sent message to RMQ&quot;);&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.nitk.alertservice.service;&#10;&#10;import org.springframework.stereotype.Service;&#10;import com.rabbitmq.client.ConnectionFactory;&#10;import com.rabbitmq.client.Connection;&#10;import com.rabbitmq.client.Channel;&#10;&#10;@Service&#10;public class RMQService {&#10;    private final static String QUEUE_NAME = &quot;ALERTS&quot;;&#10;    private final ConnectionFactory factory;&#10;&#10;    public RMQService() {&#10;        factory = new ConnectionFactory();&#10;        String rmqHost = System.getenv(&quot;RABBITMQ_HOST&quot;);&#10;        if (rmqHost == null || rmqHost.isEmpty()) {&#10;            rmqHost = &quot;localhost&quot;;&#10;        }&#10;        factory.setHost(rmqHost);&#10;    }&#10;&#10;    public void publishNotification(byte[] message) {&#10;        try (Connection connection = factory.newConnection();&#10;             Channel channel = connection.createChannel()) {&#10;            channel.queueDeclare(QUEUE_NAME, false, false, false, null);&#10;            channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message);&#10;            System.out.println(&quot; [x] Sent message to RMQ&quot;);&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/gateway/src/main/java/org/nitk/gateway/GatewayApplication.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/gateway/src/main/java/org/nitk/gateway/GatewayApplication.java" />
              <option name="originalContent" value="package org.nitk.gateway;&#10;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.web.servlet.function.RouterFunction;&#10;import org.springframework.web.servlet.function.ServerRequest;&#10;import org.springframework.web.servlet.function.ServerResponse;&#10;&#10;import jakarta.servlet.http.Cookie;&#10;import org.nitk.gateway.security.JwtService;&#10;&#10;import static org.springframework.cloud.gateway.server.mvc.filter.BeforeFilterFunctions.uri;&#10;import static org.springframework.cloud.gateway.server.mvc.handler.GatewayRouterFunctions.route;&#10;import static org.springframework.cloud.gateway.server.mvc.handler.HandlerFunctions.http;&#10;import static org.springframework.cloud.gateway.server.mvc.predicate.GatewayRequestPredicates.path;&#10;&#10;@SpringBootApplication(exclude = {&#10;        org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration.class,&#10;        org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration.class&#10;})&#10;public class GatewayApplication {&#10;&#10;    // Resolve downstream service hosts from environment with localhost fallback&#10;    private static String host(String env, String fallback) {&#10;        String v = System.getenv(env);&#10;        return (v == null || v.isBlank()) ? fallback : v;&#10;    }&#10;&#10;    public static final String AUTH_URI = &quot;http://&quot; + host(&quot;AUTH_HOST&quot;, &quot;localhost&quot;) + &quot;:5001&quot;;&#10;    public static final String ALERT_URI = &quot;http://&quot; + host(&quot;ALERT_HOST&quot;, &quot;localhost&quot;) + &quot;:5002&quot;;&#10;    public static final String REQUEST_URI = &quot;http://&quot; + host(&quot;REQUEST_HOST&quot;, &quot;localhost&quot;) + &quot;:5003&quot;;&#10;&#10;    public static void main(String[] args) {&#10;        SpringApplication.run(GatewayApplication.class, args);&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; authRouter() {&#10;        return route()&#10;                .route(path(&quot;/auth/**&quot;), http())&#10;                .before(uri(AUTH_URI))&#10;                .build();&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; alertRouter(JwtService jwtService) {&#10;        return route()&#10;                .route(path(&quot;/alerts/**&quot;), http())&#10;                .filter((req, next) -&gt; {&#10;                    if (!isValidToken(req, jwtService)) {&#10;                        return ServerResponse.status(401).build();&#10;                    }&#10;                    return next.handle(req);&#10;                })&#10;                .before(uri(ALERT_URI))&#10;                .build();&#10;    }&#10;&#10;    static boolean isValidToken(ServerRequest req, JwtService jwtService) {&#10;        Cookie jwtCookie = req.cookies().getFirst(&quot;jwt&quot;);&#10;        String token = jwtCookie != null ? jwtCookie.getValue() : null;&#10;        return jwtService.isValid(token);&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; requestRouter(JwtService jwtService) {&#10;        return route()&#10;                .route(path(&quot;/requests/**&quot;), http())&#10;                .filter((req, next) -&gt; {&#10;                    if (!isValidToken(req, jwtService)) {&#10;                        return ServerResponse.status(401).build();&#10;                    }&#10;                    return next.handle(req);&#10;                })&#10;                .before(uri(REQUEST_URI))&#10;                .build();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.nitk.gateway;&#10;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.web.servlet.function.RouterFunction;&#10;import org.springframework.web.servlet.function.ServerRequest;&#10;import org.springframework.web.servlet.function.ServerResponse;&#10;&#10;import jakarta.servlet.http.Cookie;&#10;import org.nitk.gateway.security.JwtService;&#10;&#10;import static org.springframework.cloud.gateway.server.mvc.filter.BeforeFilterFunctions.uri;&#10;import static org.springframework.cloud.gateway.server.mvc.handler.GatewayRouterFunctions.route;&#10;import static org.springframework.cloud.gateway.server.mvc.handler.HandlerFunctions.http;&#10;import static org.springframework.cloud.gateway.server.mvc.predicate.GatewayRequestPredicates.path;&#10;&#10;@SpringBootApplication(exclude = {&#10;        org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration.class,&#10;        org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration.class&#10;})&#10;public class GatewayApplication {&#10;&#10;    // Resolve downstream service hosts from environment with localhost fallback&#10;    private static String host(String env, String fallback) {&#10;        String v = System.getenv(env);&#10;        return (v == null || v.isBlank()) ? fallback : v;&#10;    }&#10;&#10;    public static final String AUTH_URI = &quot;http://&quot; + host(&quot;AUTH_HOST&quot;, &quot;localhost&quot;) + &quot;:5001&quot;;&#10;    public static final String ALERT_URI = &quot;http://&quot; + host(&quot;ALERT_HOST&quot;, &quot;localhost&quot;) + &quot;:5002&quot;;&#10;    public static final String REQUEST_URI = &quot;http://&quot; + host(&quot;REQUEST_HOST&quot;, &quot;localhost&quot;) + &quot;:5003&quot;;&#10;&#10;    public static void main(String[] args) {&#10;        SpringApplication.run(GatewayApplication.class, args);&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; authRouter() {&#10;        return route()&#10;                .route(path(&quot;/auth/**&quot;), http())&#10;                .before(uri(AUTH_URI))&#10;                .build();&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; alertRouter(JwtService jwtService) {&#10;        return route()&#10;                .route(path(&quot;/alerts/**&quot;), http())&#10;                .filter((req, next) -&gt; {&#10;                    if (!isValidToken(req, jwtService)) {&#10;                        return ServerResponse.status(401).build();&#10;                    }&#10;                    return next.handle(req);&#10;                })&#10;                .before(uri(ALERT_URI))&#10;                .build();&#10;    }&#10;&#10;    static boolean isValidToken(ServerRequest req, JwtService jwtService) {&#10;        Cookie jwtCookie = req.cookies().getFirst(&quot;jwt&quot;);&#10;        String token = jwtCookie != null ? jwtCookie.getValue() : null;&#10;        return jwtService.isValid(token);&#10;    }&#10;&#10;    @Bean&#10;    public RouterFunction&lt;ServerResponse&gt; requestRouter(JwtService jwtService) {&#10;        return route()&#10;                .route(path(&quot;/requests/**&quot;), http())&#10;                .filter((req, next) -&gt; {&#10;                    if (!isValidToken(req, jwtService)) {&#10;                        return ServerResponse.status(401).build();&#10;                    }&#10;                    return next.handle(req);&#10;                })&#10;                .before(uri(REQUEST_URI))&#10;                .build();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/request-service/src/main/java/org/nitk/requestservice/config/MongoConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/request-service/src/main/java/org/nitk/requestservice/config/MongoConfig.java" />
              <option name="originalContent" value="package org.nitk.requestservice.config;&#10;&#10;import com.mongodb.ConnectionString;&#10;import com.mongodb.MongoClientSettings;&#10;import com.mongodb.client.MongoClient;&#10;import com.mongodb.client.MongoClients;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;&#10;@Configuration&#10;public class MongoConfig {&#10;&#10;    @Bean&#10;    public MongoClient mongoClient() {&#10;        String mongoHost = System.getenv(&quot;MONGO_HOST&quot;);&#10;        if (mongoHost == null || mongoHost.isEmpty()) {&#10;            mongoHost = &quot;localhost&quot;;&#10;        }&#10;        return MongoClients.create(&#10;                MongoClientSettings.builder()&#10;                        .applyConnectionString(new ConnectionString(&quot;mongodb://&quot; + mongoHost + &quot;:27017&quot;))&#10;                        .build()&#10;        );&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.nitk.requestservice.config;&#10;&#10;import com.mongodb.ConnectionString;&#10;import com.mongodb.MongoClientSettings;&#10;import com.mongodb.client.MongoClient;&#10;import com.mongodb.client.MongoClients;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;&#10;@Configuration&#10;public class MongoConfig {&#10;&#10;    @Bean&#10;    public MongoClient mongoClient() {&#10;        String mongoHost = System.getenv(&quot;MONGO_HOST&quot;);&#10;        if (mongoHost == null || mongoHost.isEmpty()) {&#10;            mongoHost = &quot;localhost&quot;;&#10;        }&#10;        return MongoClients.create(&#10;                MongoClientSettings.builder()&#10;                        .applyConnectionString(new ConnectionString(&quot;mongodb://&quot; + mongoHost + &quot;:27017&quot;))&#10;                        .build()&#10;        );&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>